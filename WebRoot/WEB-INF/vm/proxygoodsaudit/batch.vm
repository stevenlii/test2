<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="${request.contextPath}/profile/default/css/common.css" type="text/css">
<link rel="stylesheet" href="${request.contextPath}/js/ui/themes/default/om-all.css" type="text/css">
<script src="$request.contextPath/js/ui/jquery.min.js"></script>
<script src="$request.contextPath/js/ui/js/om-core.js"></script>
<script type="text/javascript" src="$request.contextPath/js/ui/js/om-grid.js"></script>
<script src="$request.contextPath/js/ui/js/om-mouse.js"></script>
<script src="$request.contextPath/js/ui/js/om-draggable.js"></script>
<script src="$request.contextPath/js/ui/js/om-position.js"></script>
<script src="$request.contextPath/js/ui/js/om-resizable.js"></script>
<script src="$request.contextPath/js/ui/js/om-dialog.js"></script>
<script src="$request.contextPath/js/ui/js/om-validate.js"></script>
<script src="$request.contextPath/js/ui/js/om-messagebox.js"></script>
<script src="$request.contextPath/js/ui/js/om-button.js"></script>
<script src="$request.contextPath/js/ui/js/om-combo.js"></script>
<script src="$request.contextPath/js/busi/common.js"></script>
<script src="$request.contextPath/js/busi/proxygoodsaudit.js"></script>
<script type="text/javascript" src="$request.contextPath/js/ui/js/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript">
    var url ="$request.contextPath/proxygoodsaudit/batchQuery.do";
    
    var optStr="${opts}";
	var opts=optStr.split(',');
	jQuery('[code]').each(function () {
		var code=$(this).attr("code");
		for(var i=0;i<opts.length;i++){
			if(code==opts[i]){
				$(this).css('display','inline');						
			}
		};
	});
    
    jQuery(document).ready(function() {
    	jQuery("#search_div").width(jQuery(window).width()-20);
        jQuery('#grid').omGrid({
            dataSource : "$request.contextPath/proxygoodsaudit/batchQuery.do?queryKey=audit.allBatchProxyGoodsAudits",
            width:'100%',
            height : 445,
            limit : 15,
            colModel : [ 
                 {header : '审核类型', name : 'AUDITTYPE', width : 50, align : 'left',renderer:function(value , rowData , rowIndex){
                 	var auditType = rowData.AUDITTYPE;
                 	var name = "";
                 	if (auditType=='1'){
                 		name = "新增";
                 	}else if (auditType=='2'){
                 		name = "修改";
                 	}else if (auditType=='3'){
                 		name = "启用";
                 	}else if (auditType=='4'){
                 		name = "禁用";
                 	}else{
                 		name = "未知";
                 	}
                 	return "<a title='"+name+"'>"+name+"</a>";
                 }}, 
               
                  {header : '提交时间', name : 'INTIME', width : 100, align : 'left',renderer:function(value , rowData , rowIndex){
      				return "<a title='"+value+"'>"+value+"</a>";
      			}}, 
                 {header : '提交人', name : 'CREATOR', width : 60, align : 'left',renderer:function(value , rowData , rowIndex){
    				return "<a title='"+value+"'>"+value+"</a>";
    			}}, 
    			
                 {header : '审核人', name : 'MODUSER', width : 60, align : 'left',renderer:function(value , rowData , rowIndex){
     				return "<a title='"+value+"'>"+value+"</a>";
     			}}, 
     			{header : '审核时间', name : 'MODTIME', width : 100, align : 'left',renderer:function(value , rowData , rowIndex){
     				return "<a title='"+value+"'>"+value+"</a>";
     			}}, 
                 {header : '审核状态', name : 'STATE', width : 60, align : 'left', renderer:function(value , rowData , rowIndex){
                 	var state = rowData.STATE;
                 	var name = "";
                 	if (state==1){
                 		name = "不通过";
                 	}else if (state==0){
                 		name = "待审核";
                 	}else if (state==2){
                 		name = "通过";
	     			}
	             	return "<a title='"+name+"'>"+name+"</a>";
                 }},
                  {header : '操作', name : 'oper', width : 70, align : 'left', renderer:function(value , rowData , rowIndex){
                 	var state = rowData.STATE;
                 	var auditType = rowData.AUDITTYPE;
                 	var id = rowData.BATCHID;
                 	var result="";
                 	if (auditType=='0'){
                 		return "<span color='red'>非法数据</span>";
                 	} else {
	                 	if (state==0){  //待审核，操作按钮正常
	                 		if(optStr.indexOf("013")!=-1){
                     			result+="<input name='通过' title='通过' type='image' src='${request.contextPath}/profile/default/images/tool_pass.png' onclick='goPass(&quot;" + id + "&quot;)'/>&nbsp;";
                     		}
                     		if(optStr.indexOf("014")!=-1){
                     			result+="<input name='不通过' title='不通过' type='image' src='${request.contextPath}/profile/default/images/tool_nopass.png' onclick='notPass(&quot;" + id + "&quot;)'/>&nbsp;";
                     		}
	                 	}else{  //已审核，操作按钮变灰
	                 		if(optStr.indexOf("013")!=-1){
                     			result+="<input name='通过' title='通过' type='image' src='${request.contextPath}/profile/default/images/tool_pass1.png' />&nbsp;";
                     		}
                     		if(optStr.indexOf("014")!=-1){
                     			result+="<input name='不通过' title='不通过' type='image' src='${request.contextPath}/profile/default/images/tool_nopass1.png' />&nbsp;";
                     		}
	                 	}
	                 	result+="<input id='detail' name='detail' type='image' title='详细' src='${request.contextPath}/profile/default/images/tool_details.png' onclick='showBatchDetailAudit(&quot;" + id + "&quot;, " + auditType + "," + state + ")' />";
                     	return result;
	                 }
                 }}
                 ],
                 autoFit : true

        });
        
        //获取提交人列表
        $('#creator').omCombo({
        		dataSource : '$request.contextPath/option/creatorlist.do',
        		width:'85px',
        		listMaxHeight:150,
        		emptyText:'全部 ' ,
        		onSuccess:function(data, textStatus, event){
  					var tmp = $.parseJSON('{"value":"","text":"全部"}');
      	  			data.unshift(tmp);
 				},
         		forceSelection : true
            });
        
        //获取审核人列表   modUser
        $('#modUser').omCombo({
               	dataSource : '$request.contextPath/option/modUserlist.do',
               	width:'85px',
               	listMaxHeight:150,
               	emptyText:'全部 ' ,
               	onSuccess:function(data, textStatus, event){
      	  			var tmp = $.parseJSON('{"value":"","text":"全部"}');
      	  			data.unshift(tmp);
         		},
         		forceSelection : true
            });
        //审核类型列表
        $('#auditType').omCombo({
            dataSource : [{"value":"","text":"全部"},{"value":"1","text":"新增"},{"value":"2","text":"修改"}
            				,{"value":"3","text":"启用"},{"value":"4","text":"禁用"}],
            width:'90px',
            emptyText:'全部 ',
            forceSelection : true
        });
        //审核状态列表
        $('#state').omCombo({
            dataSource : [{"value":"","text":"全部"},{"value":"0","text":"待审核"}
            				,{"value":"1","text":"不通过"},{"value":"2","text":"通过"}],
            width:'90px',
            emptyText:'全部 ' ,
            forceSelection:true
        });
        $('#state').omCombo('value','0');
	      jQuery("#dialog").omDialog({
	            autoOpen: false
	      });
	      
		$('#grid').omGrid("setData", url+"?queryKey=audit.allBatchProxyGoodsAudits&state=0");
      
    });

	//审核通过方法
    function goPass(id){
    	$.omMessageBox.confirm({
            title:'审核通过',
            content:'确认审核通过此信息？',
            onClose:function(value){
                if (value){
                	$.ajax({
                		url : '$request.contextPath/proxygoodsaudit/goPass.do',
                		type : 'POST',
                		dataType: 'text',
                		data : {
                		'batchId' : id
                	},
                	success : function(data){
                		jQuery('#grid').omGrid('reload');
                		showAuditTip(data);  
                	}
                	});
                }
            }
        });
    }
    function notPass(id){
    	$.omMessageBox.prompt({
            title:'审核不通过',
            content:'请输入您的审核意见：',
            onClose:function(value){
                if(value===false){ //按了取消或ESC
                    return;
                }
                if(value==''){
                    alert('审核意见不能为空');
                    return false; //不关闭弹出窗口
                }
                if(byteCount(value)>64){
            		alert("审核意见最大长度为64个字符！")
            		return false;
            	}
        		$.ajax({
        				url : '$request.contextPath/proxygoodsaudit/notPass.do',
        				type : 'POST',
        				dataType: 'text',
        				data : {
        						'batchId' : id,
        						'resultDesc' : value
        				},
        				success : function(data){
        					shuaxin();
        					showAuditTip(data);
        				}
        		});
            }
        });
    }
</script>
</head>
<body>
<!--背景-->
<div class="list_btntool" style="height:1px;"></div>
   <!--列表查询区-->
   <div  id="search_div">
	<div class="list_search" >
     <table width="90%" border="0" align="left">
       <tr>
         <th width="7%" height="30">审核状态：</th>
         <td width="10%"><input id="state" name="state" class="select1"/></td>
         <th width="7%">二级商户号：</th>
         <td width="10%"><input id="subMerId" name="subMerId" type="text" class="input1" /></td>
         <th width="7%">代理商户号：</th>
         <td width="10%"><input id="merId" name="merId" type="text" class="input1"/></td>
         <th width="7%">提交时间：</td>
         <td width="15%"><input type="text" id="from" name="from" onfocus="WdatePicker({startDate:'%y-%M-%d 00:00:00',dateFmt:'yyyy-MM-dd HH:mm:ss'})" class="Wdate" style="width:150px"/></td>
         <th width="7%">代理商品号：</th>
         <td width="10%"><input id="goodsId" name="goodsId" type="text" class="input1"/></td>
         <th rowspan="2"><input id="query" name="query" type="image" src="${request.contextPath}/profile/default/images/Search_bnt.png" onclick="batchquery()"/></th>
       </tr>
       <tr>
       <th>审核类型：</th>
       <td><input id="auditType" name="auditType" class="select1"/></td>
         <th>提交人：</th>
         <td><input id="creator" name="creator" class="select1"" /> </td>
         <th>审核人：</th>
         <td><input id="modUser" name="modUser" class="select1" /></td>
         <th>至：</th>
         <td><input type="text" id="to" name="to" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})" class="Wdate" style="width:150px"/></td>
         <th></th>
         <td></td>
       </tr>
     </table>
    </div>
   </div>
   <!--列表区-->
   <div align="center">
         <table align="left" id="grid" ></table>
     </div>
  
 <div id="dialog">
    	<iframe frameborder="0" style="width:100%;height:100%" src="about:blank"></iframe>
 </div>
</body>
</html>
