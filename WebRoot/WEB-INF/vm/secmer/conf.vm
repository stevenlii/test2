<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head> 
<link rel="stylesheet" type="text/css" href="${request.contextPath}/profile/default/css/common.css">
<link rel="stylesheet" href="$request.contextPath/js/ui/themes/default/om-all.css" type="text/css">
<link rel="stylesheet" type="text/css" href="${request.contextPath}/profile/validate/css/v1.css">
<script src="$request.contextPath/js/ui/jquery.min.js"></script>
<script src="$request.contextPath/js/ui/js/om-core.js"></script>
<script src="$request.contextPath/js/ui/js/om-validate.js"></script>
<script src="$request.contextPath/js/ui/js/om-combo.js"></script>
<script type="text/javascript" src="$request.contextPath/js/ui/js/om-ajaxsubmit.js"></script>
<script src="$request.contextPath/js/ui/js/om-messagebox.js"></script>
<script src="$request.contextPath/js/ui/js/om-button.js"></script>
<script src="$request.contextPath/js/busi/secmer.js"></script>
<script>
  jQuery(document).ready(function() {
  		jQuery("#container").width(jQuery(window).width());
  		
  		$.validator.addMethod("check2", function(value) {
  	  		//根据按次或包月检查是否需要填写
  			var inFunCode=$('input:radio[name="inFunCode"]:checked').val();
 	 	    if(inFunCode=="2" && value=="")
 	 	    	return false;
 	 	    else
 	 	    	return true;
  	 	    }, "请输入");
  		$.validator.addMethod("check3", function(value) {
  	  		//根据按次或包月检查是否需要填写
  			var inFunCode=$('input:radio[name="inFunCode"]:checked').val();
 	 	    if(inFunCode=="3" && value==""){
 	 	    	return false;
 	 	    }else
 	 	    	return true;
  	 	    }, "请输入");
  		
  	 	jQuery("#dataform").validate({
 		  	onkeyup: false,
            rules : {
		         "notifyUrl2": {check2 : true, maxlength : 128},
		         "orderUrl2": {check2 : true, maxlength : 128},
		         "notifyUrl3": {check3 : true, maxlength : 128},
		         "orderUrl3": {check3 : true, maxlength : 128}
            },
            messages : {
                "notifyUrl2": {maxlength : "最多128个字符"},
                "orderUrl2": {maxlength : "最多128个字符"},
                "notifyUrl3": {maxlength : "最多128个字符"},
                "orderUrl3": {maxlength : "最多128个字符"}
            },
            errorPlacement : function(error, element) {
                if(error.html()){
                    $(element).parents().map(function(){
                        if(this.tagName.toLowerCase()=='td'){
                            var attentionElement = $(this).next().children().eq(0);
                            attentionElement.css('display','block');
    	                    attentionElement.next().html(error);
    	                    attentionElement.next().css('display','block');
                        }
                    });
                }
	        },
	        showErrors: function(errorMap, errorList) {
                if(errorList && errorList.length > 0){
                    $.each(errorList,function(index,obj){
                        var msg = this.message;
                        $(obj.element).parents().map(function(){
	                        if(this.tagName.toLowerCase()=='td'){
	                            var attentionElement = $(this).next().children().eq(0);
	                            attentionElement.show();
	    	                    attentionElement.next().html(msg);
	                        }
	                    });
                   });
                }else{
                    $(this.currentElements).parents().map(function(){
                        if(this.tagName.toLowerCase()=='td'){
                            $(this).next().children().eq(0).hide();
                            $(this).next().children().eq(1).hide();
                        }
                    });
                }
                this.defaultShowErrors();
            },
            submitHandler : function(){
				jQuery(this).submit();
                return false;
            }
        });
  	 	  
  	 	jQuery('#dataform').submit(function() {
  	 	  	 if (!jQuery("#dataform").valid()) 
                 return false;
  	 	  	
  	 	     var inFunCode=$('input:radio[name="inFunCode"]:checked').val();
  	 	     var url;
  	 	     if(inFunCode=="2"){
  	 	    	$('#notifyUrl').val($('#notifyUrl2').val());
  	 	    	$('#orderUrl').val($('#orderUrl2').val());
  	 	    	if($('#op2').val()=="0")
  	 	    		url="addConf.do";
  	 	    	else 
  	 	    		url="updateConf.do";
  	 	     }else if(inFunCode=="3"){
  	 	    	$('#notifyUrl').val($('#notifyUrl3').val());
  	 	    	$('#orderUrl').val($('#orderUrl3').val());
  	 	    	if($('#op3').val()=="0")
  	 	    		url="addConf.do";
  	 	    	else 
  	 	    		url="updateConf.do";
  	 	     }
             jQuery(this).omAjaxSubmit({
            	 url:url,
            	 success:function(res){
            		var msg = "";
		  			var ty = "";
	           		if(res !='1') {
	           			ty = 'error';
	    		  		var msg = '操作失败';
	    		  		if(res=='2'){
	    		  			alert("证书大小不能超过4000个字节");
	    		  			return false;
	 	    		    }else if(res=='4'){
	 	    		    	alert("首次配置请添加证书");
	 	    		    	return false;
	 	    		    }
	    		  	}else{
	    			   ty = 'success';
	    			   msg = '操作成功';
	    			   closeDialog(); 
	    		    }
	           		window.parent.$.omMessageBox.alert({
	           			type : ty,
	           			title : '操作提示',
	           			content : msg
	           		});
	             }
	         });
	         return false; 
          });
 	      
 	      jQuery("input[name='inFunCode']").click(function(){
 			  if(this.value == '2'){
 	 			$('#tr_notifyUrl3').hide();
 				$('#tr_orderUrl3').hide();
 				$('#tr_notifyUrl2').show();
 				$('#tr_orderUrl2').show();
 			  }else{
 				$('#tr_notifyUrl2').hide();
   				$('#tr_orderUrl2').hide();
  				$('#tr_notifyUrl3').show();
  				$('#tr_orderUrl3').show();
 			  }
 	      });
  });
//关闭窗口方法
  function  closeDialog(){
    window.parent.fillBackAndCloseDialog("#dialog"); 
  }
</script>  
  </head>
  <body>
<div id="container">
         <form id ="dataform" method="post" name="dataform" action="${request.contextPath}/secmer/updateConf.do" enctype="multipart/form-data">
         <input type="hidden" name="subMerId" value="$!{subMerId}">
         <input type="hidden" id="op2" name="op2" value="$!{op2}">
         <input type="hidden" id="op3" name="op3" value="$!{op3}">
         <input type="hidden" id="notifyUrl" name="notifyUrl">
         <input type="hidden" id="orderUrl" name="orderUrl">
         <table width="100%" >
         <tr><td>
            <table width="100%" cellpadding="0" cellspacing="0" class="infowrite">
              <tr>
                <th width="35%" align="left"><span>*</span>商户号：</th>
                <td class="td">$!{subMerId}</td>
                <td width="40%" class="td"></td>
              </tr>
              <tr>
                <th width="35%" align="left"><span>*</span>商户名称：</th>
                <td class="td1">$!{subMerName}</td>
                <td width="40%" class="td1"></td>
              </tr>
              <tr>
                <th width="35%" align="left"><span>*</span>接口标识：</th>
                <td class="td">
                  <input type='radio' name='inFunCode' value="2" checked>按次&nbsp;&nbsp;
                  <input type='radio' name='inFunCode' value="3">包月
                </td>
                <td width="40%" class="td"></td>
              </tr>
              <tr id="tr_notifyUrl2">
                <th width="35%" align="left"><span>*</span>通知地址：</th>
                <td class="td1"><input id="notifyUrl2" name="notifyUrl2" value="$!{smc2.notifyUrl}"  type="text"  size="20" maxlength="64"  class="input2"></td>
                <td width="40%" class="td1"> <span class="errorImg"></span><span class="errorMsg" ></span></td>
              </tr>
              <tr id="tr_notifyUrl3" style="display:none">
                <th width="35%" align="left"><span>*</span>通知地址：</th>
                <td class="td1"><input id="notifyUrl3" name="notifyUrl3" value="$!{smc3.notifyUrl}"  type="text"  size="20" maxlength="64"  class="input2"></td>
                <td width="40%" class="td1"> <span class="errorImg"></span><span class="errorMsg" ></span></td>
              </tr>
              <tr id="tr_orderUrl2">
                <th width="18%" align="left"><span>*</span>下单地址：</th>
                <td class="td"><input  id="orderUrl2" name="orderUrl2" value="$!{smc2.orderUrl}"  type="text"  size="20" maxlength="64"  class="input2"></td>
                <td width="40%" class="td"> <span class="errorImg"></span><span class="errorMsg" ></span></td>
              </tr>
              <tr id="tr_orderUrl3" style="display:none">
	            <th width="18%" align="left"><span>*</span>下单地址：</th>
	            <td class="td"><input  id="orderUrl3" name="orderUrl3" value="$!{smc3.orderUrl}"  type="text"  size="20" maxlength="64"  class="input2"></td>
	            <td width="40%" class="td"> <span class="errorImg"></span><span class="errorMsg" ></span></td>
	           </tr>
              <tr>
                <th width="18%" align="left">证书：</th>
                <td class="td1">
                  <input name="file" type="file" class="input2" />
                </td>
                <td class="td1"><span class="errorImg"></span><span class="errorMsg"></span></td>
              </tr>
            </table>
          </td></tr><tr><td>
              <table width="100%" cellpadding="0" cellspacing="0">
                  <tr>
                    <td height="15"></td>
                  </tr>
                  <tr>
                    <td align="center"><input name="conf" type="submit" value="提交" class="popbtn" onmouseover="this.className='popbtnhover'" onmouseout="this.className='popbtn'"/>
                    <input id="add_button2" name="add_button2" type="reset"  value="取消" class="popbtn" onmouseover="this.className='popbtnhover'" onmouseout="this.className='popbtn'" onclick="closeDialog();"/>
                  </tr>
                </table>
            </td></tr>
            <table>
          </form>
</div>
</body>
</html>