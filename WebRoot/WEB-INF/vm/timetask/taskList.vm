<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="${request.contextPath}/js/ui/themes/default/om-all.css" type="text/css">
<link rel="stylesheet" type="text/css" href="${request.contextPath}/profile/default/css/common.css" >
<script src="$request.contextPath/js/ui/jquery.min.js"></script>
<script src="$request.contextPath/js/ui/js/om-core.js"></script>
<script type="text/javascript" src="$request.contextPath/js/ui/js/om-grid.js"></script>
<script src="$request.contextPath/js/ui/js/om-mouse.js"></script>
<script src="$request.contextPath/js/ui/js/om-draggable.js"></script>
<script src="$request.contextPath/js/ui/js/om-position.js"></script>
<script src="$request.contextPath/js/ui/js/om-resizable.js"></script>
<script src="$request.contextPath/js/ui/js/om-dialog.js"></script>
<script src="$request.contextPath/js/ui/js/om-validate.js"></script>
<script src="$request.contextPath/js/ui/js/om-messagebox.js"></script>
<script src="$request.contextPath/js/ui/js/om-messagetip.js"></script>
<script src="$request.contextPath/js/ui/js/om-button.js"></script>
<script src="$request.contextPath/js/ui/js/om-combo.js"></script>
<script type="text/javascript" src="$request.contextPath/js/ui/js/om-ajaxsubmit.js"></script>
<script src="$request.contextPath/js/busi/hftask.js"></script>
<script type="text/javascript">
    jQuery(document).ready(function() {
       //用于更具权限判断控件是否显示
    	var optStr = "${opts}";
        var opts = optStr.split(',');
        jQuery('[code]').each(function() {
            var code = $(this).attr("code");
            for (var i = 0; i < opts.length; i++) {
                if (code == opts[i]) {
                    $(this).css('display', 'inline');
                }
            };
        });
        
        
      	//启用状态下拉框
  	 	$('#state').omCombo({
            dataSource: [{text:'全部',value:''},
                         {text:'启用',value:'2'}, 
                         {text:'不启用',value:'4'}], 
            width: '60px',
            emptyText: '全部',
            forceSelection: true
        });
      	
  		//初始化所属平台名称下拉框
        $('#platName').omCombo({
            dataSource: '$request.contextPath/option/dropdownlist.do?paraType=platNames',
            width: '150px',
            emptyText: '全部',
            forceSelection: true,
            onSuccess:function(data, textStatus, event){
		      	  var tmp = $.parseJSON('{"value":"","text":"全部"}');
		      	  data.unshift(tmp);
	   		}
        });
		
        //查询表格
        jQuery('#grid').omGrid({
            dataSource: "$request.contextPath/timetask/queryTaskInfo.do?queryKey=hfTask.queryTaskInfo",
            width: '100%',
            height: 475,
            limit: 15,
            title : '定 时 任 务 信 息',
            colModel: [{
                header: '所属平台',
                name: 'PLATNAME',
                width: 120,
                align: 'center'
            },
        
            {
                header: '任务说明',
                name: 'TASKDESC',
                width: 175,
                align: 'left',
				renderer: function(value, rowData, rowIndex) {
					return "<a title='" + rowData.TASKDESC + "'>" + rowData.TASKDESC + "</a>";
                }
            },
            {
                header: '定时规则',
                name: 'TASKRULEDESC',
                width: 160,
                align: 'left'
            },
            {
                header: '下次执行时间',
                name: 'NEXTRUNTIME',
                width: 110,
                align: 'center'
            },
            {
                header: '是否启用',
                name: 'STATE',
                width: 50,
                align: 'center'
            },
            {
                header: '触发地址',
                name: 'POSTURL',
                width: 190,
                align: 'left',
                renderer: function(value, rowData, rowIndex) {
                	return "<a title='" + rowData.POSTURL + "'>" + rowData.POSTURL + "</a>";
                }
            },
            {
                header: '错误重试',
                name: 'ISRETRY',
                width: 50,
                align: 'center'
            },
            {
                header: '最后编制人',
                name: 'MODUSER',
                width: 80,
                align: 'left',
                renderer: function(value, rowData, rowIndex) {
                	return "<a title='" + rowData.MODUSER + "'>" + rowData.MODUSER + "</a>";
                }
            },
            {
                header: '操作',
                name: 'OPT',
                width: 70,
                align: 'left',
                renderer: function(value, rowData, rowIndex) {
                    var result = "<img title='详情' src='${request.contextPath}/profile/default/images/tool_details.png' onclick='showDetailDialog(\"" + rowData.TASKID + "\")' />";
					result += "&nbsp;&nbsp;<img title='修改' src='${request.contextPath}/profile/default/images/tool_modify.png' onclick='showModifyDialog(\"" + rowData.TASKID + "\")' />";
					result += "&nbsp;&nbsp;<img title='手动即刻执行' src='${request.contextPath}/profile/default/images/sdtask.png' onclick='showManualRunTaskDialog(\"" + rowData.TASKID + "\")' />";
                    return result;
                }
            }],
            autoFit: false
        });

        jQuery( "#dialog").omDialog({
            autoOpen: false
        });
        
		jQuery('#modify').bind('click',
        function() {
            var selections = $('#grid').omGrid('getSelections', true);
            if (selections.length == 0) {
                alert('请至少选择一行记录');
                return false;
            }
            showModifyDialog(selections[0].MERID); //显示dialog
        });
		
		$('.errorImg').bind('mouseover',function(){
        $(this).next().css('display','block');
		}).bind('mouseout',function(){
				$(this).next().css('display','none');
		});
		
		jQuery('#dataform').submit(function() {
			if (!jQuery("#dataform").valid()) 
				return false;
			jQuery(this).omAjaxSubmit({success:function(res){
		      showSimpleTip(res);
				close();
			}
			});
			
			return false; 
		});
	});
	
	
</script>
</head>
<body>
 <div class="main_list">
   <!--列表查询区-->
   <div class="list_search" style="height: 40px;">
   <table width="100%" border="0">
   <tr>
    <td>
      <form id="form" action="" method="post"> 
        <table width="100%" border="0">
          <tr height="50">
            <th width="10%">所属平台：</th>
            <td width="13%"><input id="platName"  name="platName" /></td>
           	<th width="10%">任务说明：</th>
            <td width="13%" nowrap="nowrap"><input id="taskDesc" name="taskDesc" type="text" class="input2" maxlength="50"/></td>
            <td width="15%">(支持模糊查询)</td>
		   	<th width="10%">启用状态：</th>
            <td><input id="state"  name="state" /></td>
         </tr>
        </table>
       </form> 
       </td>
        <td>
			<input id="query" code="001"  name="query" type="image" value="ee" src="${request.contextPath}/profile/default/images/Search_bnt.png" onclick="queryTaskInfo()"  />
			&nbsp;&nbsp;&nbsp;&nbsp;<input name="添加兑换券" code="005" type="image"  value="ee" src="${request.contextPath}/profile/default/images/btn_Add.png" onclick="add()"/>
        </td>
       </tr>
        </table>
      </div>
    
 <!--列表查询区-->

  <div align="center">
         <table  align="left" id="grid" ></table>
     </div>
    
  
 <div id="dialog">
	<iframe frameborder="0" style="width:100%;height:99%" src="about:blank"></iframe>
 </div>

</body>
</html>
