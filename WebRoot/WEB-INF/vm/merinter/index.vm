<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="${request.contextPath}/js/ui/themes/default/om-all.css" type="text/css">
<link rel="stylesheet" type="text/css" href="${request.contextPath}/profile/default/css/common.css">
<script src="$request.contextPath/js/ui/jquery.min.js"></script>
<script src="$request.contextPath/js/ui/js/om-core.js"></script>
<script type="text/javascript" src="$request.contextPath/js/ui/js/om-grid.js"></script>
<script src="$request.contextPath/js/ui/js/om-mouse.js"></script>
<script src="$request.contextPath/js/ui/js/om-draggable.js"></script>
<script src="$request.contextPath/js/ui/js/om-position.js"></script>
<script src="$request.contextPath/js/ui/js/om-resizable.js"></script>
<script src="$request.contextPath/js/ui/js/om-dialog.js"></script>
<script src="$request.contextPath/js/ui/js/om-combo.js"></script>
<script src="$request.contextPath/js/ui/js/om-messagebox.js"></script>
<script src="$request.contextPath/js/ui/js/om-button.js"></script>
<script src="$request.contextPath/js/ui/js/om-validate.js"></script>
<script type="text/javascript" src="$request.contextPath/js/ui/js/om-ajaxsubmit.js"></script>
<script src="$request.contextPath/js/busi/merInter.js"></script>
<script src="$request.contextPath/js/busi/common.js"></script>
<script type="text/javascript">

	var url="$request.contextPath/merinter/query.do?queryKey=merinter.allMerInter";
	jQuery(document).ready(function() {
		jQuery("#search_div").width(jQuery(window).width()-20);
		
		var optStr="${opts}";
		var opts=optStr.split(',');
		jQuery('[code]').each(function () {
			var code=$(this).attr("code");
			for(var i=0;i<opts.length;i++){
				if(code==opts[i]){
					$(this).css('display','inline');
				}
			};
		});
		
          jQuery('#grid').omGrid({
                dataSource : url,
                width:'100%',
                height : 455,
                limit : 15,
                singleSelect : false,
                colModel : [ {header : '商户号', name : 'MERID', width : 50, align : 'left',renderer:function(value , rowData , rowIndex){
                				return "<a title='"+value+"'>"+value+"</a>";
                			 } },
                             {header : '商户名称', name : 'MERNAME',width : 80, align : 'left',renderer:function(value , rowData , rowIndex){
                 	    		return "<a title='"+value+"'>"+value+"</a>";
                              } },
                             {header : '接口标识', name : 'INFUNCODE',width : 85, align : 'left',renderer:function(value , rowData , rowIndex){
                            	  return "<a title='"+value+"'>"+value+"</a>";
                             }},  
                             {header : '接口版本号', name : 'INVERSION', width : 100, align : 'left',renderer:function(value , rowData , rowIndex){
                          	    return "<a title='"+value+"'>"+value+"</a>";
                             } },
                             {header : '协议', name : 'PROTOCOL',width : 60, align : 'left',renderer:function(value , rowData , rowIndex){
                             	var name = "";
                             	if(value==0){
                             		name = "HTTP";
                             	}else if(value==1){
                             		name = "SOCKET";
                             	}else if(value==2){
                             		name = "SOAP";
                             	}
                             	return "<a title='"+name+"'>"+name+"</a>";
                             }},  
                             {header : '状态', name : 'STATE',width : 50,align : 'left',renderer:function(value , rowData , rowIndex){
                             	var state = rowData.STATE;
                             	var name = "";
                             	if(state==2){
                             		name = "启用";
                             	}else if(state==4){ 
                             		name = "禁用";
	                            }
	                          	return "<a title='"+name+"'>"+name+"</a>";
                             }
                             },
                             {header : '操作', name:'oper',width : 80, align : 'left',renderer:function(value , rowData , rowIndex){
	                             	var merId = rowData.MERID;
	                             	var inFunCode = rowData.INFUNCODE;
	                             	var inVersion = rowData.INVERSION;
	                             	var state = rowData.STATE;
	                             	var result="";
	                             	if(optStr.indexOf("007")!=-1){//有修改权限
                             			result+="<input name='修改' title='修改' type='image' src='${request.contextPath}/profile/default/images/tool_modify.png' onclick='modify(&quot;"+merId+"&quot;,&quot;"+inFunCode+"&quot;,&quot;"+inVersion+"&quot;)'/> ";
	                             	}
	                             	if(state==2){//启用状态
	                             		if(optStr.indexOf("003")!=-1){//有禁用权限，返回修改、禁用、详情按钮
	                             			result+="<input name='禁用' title='禁用' type='image'  src='${request.contextPath}/profile/default/images/tool_Disable.png' onclick='singleDisable(&quot;"+merId+"&quot;,&quot;"+inFunCode+"&quot;,&quot;"+inVersion+"&quot;)'/> ";  			                             				
	                             		}
	                             	}else{//禁用状态，不能修改
	                             		if(optStr.indexOf("004")!=-1){//有启用权限，返回修改、启用、详情按钮
	                             			result+="<input name='启用' title='启用' type='image'  src='${request.contextPath}/profile/default/images/tool_Enable.png' onclick='singleEnable(&quot;"+merId+"&quot;,&quot;"+inFunCode+"&quot;,&quot;"+inVersion+"&quot;)'/> ";
	                             		}
	                             	}
                             		result+=" <input name='详情' title='详情' type='image' src='${request.contextPath}/profile/default/images/tool_details.png' onclick='detail(&quot;"+merId+"&quot;,&quot;"+inFunCode+"&quot;,&quot;"+inVersion+"&quot;)'/>";
	                             	return result;	
                             }}
                            ],
                            autoFit:true
            });
            
            jQuery( "#dialog").omDialog({
                autoOpen: false
             });
             
          //初始化商户号列表  	
            $('#merId').omCombo({
            	dataSource : '$request.contextPath/option/merlist.do',
            	width:'150px',
            	listMaxHeight:150,
            	emptyText:'全部 ' ,
            	forceSelection : true ,
            	onSuccess:function(data, textStatus, event){
	            	var tmp = $.parseJSON('{"value":"","text":"全部"}');
	            	data.unshift(tmp);
	            }
            });
    	//状态       
      	  $('#state').omCombo({
              dataSource : [{"value":"","text":"全部"},{"value":"2","text":"启用"},{"value":"4","text":"禁用"}],
              width:'90px',
              emptyText:'全部 ' ,
              forceSelection : true
          });
        
   });
       
</script>

</head>
<body>

    <!--增 删 改按钮区-->
    <div class="list_btntool">
     
      <table border="0" width="100%">
        <tr>
        <td align="left">
             <input name="禁用" type="image" title='禁用' style="display:none" code="003" src="${request.contextPath}/profile/default/images/btn_Disable.png" onclick="batchstop();"/>
             <input name="启用" type="image" title='启用' style="display:none" code="004" src="${request.contextPath}/profile/default/images/btn_Enable.png" onclick="batchstart();"/></td>
		<td align="right">
		     <input name="添加商户接口" type="image" title='添加商户接口' style="display:none" code="005" src="${request.contextPath}/profile/default/images/btn_Add.png" onclick="add();"/>
         </tr>
        </table>
     </div>
  
 <!--列表查询区-->
 <div  id="search_div">
   <div class="list_search">
   <table width="60%" border="0">
       <tr align="left">
        <td>
          <!--查询块区 start--> 
           <form id="form" method="post"> 
           <table width="100%" border="0">
	           <tr>
		           <th width="5%">商户号：</th>
		           <td width="10%"><input id="merId" name="merId" class="select2"/></td>
		           <th width="6%">状态：</th>
		           <td width="10%"><input id="state" name="state" class="select1"/></td>
	           </tr>
           </table>
        </form> 
       </td>
       <td><input id="query" title="查询" name="submit" type="image" style="display:none" code="001" value="ee" src="${request.contextPath}/profile/default/images/Search_bnt.png" onclick="query();"/>
       </td>
       </tr>
     </table>
     </div>
   </div>  
   
   <!--列表区-->
    <table id="grid" align="left"></table>
    
 <div id="dialog">
    <iframe frameborder="0" style="width:100%;height:99%" src="about:blank"></iframe>
 </div>
</body>
</html>
