<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
<link rel="stylesheet" type="text/css" href="${request.contextPath}/profile/default/css/common.css">
<link rel="stylesheet" href="$request.contextPath/js/ui/themes/default/om-all.css" type="text/css">
<script src="$request.contextPath/js/ui/jquery.min.js"></script>
<script src="$request.contextPath/js/ui/js/om-core.js"></script>
<script src="$request.contextPath/js/ui/js/om-validate.js"></script>
<script src="$request.contextPath/js/ui/js/om-combo.js"></script>
<script type="text/javascript" src="$request.contextPath/js/ui/js/om-ajaxsubmit.js"></script>
<script src="$request.contextPath/js/ui/js/om-messagebox.js"></script>
<script src="$request.contextPath/js/ui/js/om-button.js"></script>
<script src="$request.contextPath/js/busi/codeMng.js"></script>
<link rel="stylesheet" type="text/css" href="${request.contextPath}/profile/validate/css/v1.css">
  <script>
  	 jQuery(document).ready(function() {
  		jQuery("#container").width(jQuery(window).width());
    
  	     //获取分类列表
  	    $('#category').omCombo({
                dataSource : '$request.contextPath/option/feecategory2.do',
                width:'100px',
                listMaxHeight:80,
                emptyText:'请选择..',
                forceSelection:true,
                onSuccess:function(data, textStatus, event){
		  	    	if(data.length!=0){
		  	    		$('#category').omCombo('value','$!{feeCode.category}');  //回填分类值
		  	    	}
				}
            });
  	  $('#feeType').omCombo({
          dataSource : [{"value":"2","text":"按次"},{"value":"3","text":"包月"}],
          width:'100px',
          emptyText:'请选择..' ,
          forceSelection:true
      });
  	  $('#feeType').omCombo('value','$!{feeCode.feeType.trim()}');  //回填
  	 
  	 	  jQuery("#dataform").validate({
                rules : {
                    "detail": {
                        required : true,
                        maxlength : 13
                    },
                    "feeType": {
                        required : true
                    },
                    "category": {
                        required : true
                    },
                    "amount": {
                        required : true,
                        digits : true
                    }
                },
                messages : {
                    "detail": {
                        required : "请输入代码名称",
                        maxlength : "代码名称最多13个字符"
                    },
                     "feeType"  : {
                        required : "请选择类型"
                    },
                    "category": {
                        required : "请选择分类"  
                    },
                    "amount": {
                        required : "请输入金额",
                        digits  : "金额只能为正整数"
                    }
                },
                
              errorPlacement : function(error, element) { 
                    if(error.html()){
	                    $(element).parents().map(function(){
	                        if(this.tagName.toLowerCase()=='td'){
	                            var attentionElement = $(this).next().children().eq(0);
	                            attentionElement.css('display','block');
	    	                    attentionElement.next().html(error);
	    	                    attentionElement.next().css('display','block');
	                        }
	                    });
                    }
    	        },
    	        showErrors: function(errorMap, errorList) {
                    if(errorList && errorList.length > 0){
                        $.each(errorList,function(index,obj){
                            var msg = this.message;
                            $(obj.element).parents().map(function(){
    	                        if(this.tagName.toLowerCase()=='td'){
    	                            var attentionElement = $(this).next().children().eq(0);
    	                            attentionElement.show();
    	    	                    attentionElement.next().html(msg);
    	                        }
    	                    });
 	                   });
                    }else{
                        $(this.currentElements).parents().map(function(){
	                        if(this.tagName.toLowerCase()=='td'){
	                            $(this).next().children().eq(0).hide();
	                            $(this).next().children().eq(1).hide();
	                        }
	                    });
                    }
                    this.defaultShowErrors();
                }, 
                
                submitHandler : function(){
 					jQuery(this).submit();
                    return false;
                }
            });
  	 	 jQuery('#dataform').submit(function() {
  	 	  	if (!jQuery("#dataform").valid()) 
                 return false;
  	 	  	var detail=$("input[name='detail']").val();
	 	  	var feeType=$("input[name='feeType']").val();
	 	  	var category=$("input[name='category']").val();
	 	  	var amount=$("input[name='amount']").val();
	 	  	if("$!{feeCode.detail}" == detail && "$!{feeCode.feeType}" == feeType
	  	 	  		&& "$!{feeCode.category}" == category && "$!{feeCode.amount}" == amount){
	   			window.parent.$.omMessageBox.alert({
	                content:'没有修改，不需提交'
	            });
	   			return false;
	   		}
            jQuery(this).omAjaxSubmit({success:function(result){
            		window.parent.showSimpleTip(result);
	            	if(result == '1'){
	            		closeDialog();
	            		window.parent.shuaxin();
	            	}
            	}
            });
            return false; 
  	 	 });
   	 
  	 });
  </script>  
  </head>
  <body>
<div id="container">
         <form id ="dataform" method="post" name="dataform" action="${request.contextPath}/code/update.do">
         <input name="serviceId" value="$!{feeCode.serviceId}" type="hidden"/>
         <table width="100%" >
         <tr><td>
            <table width="100%" cellpadding="0" cellspacing="0" class="infowrite">
              <tr>
                <th width="13%" align="left"><span>*</span>代码：</th>
                <td class="td"><input name="serviceId" value="$!{feeCode.serviceId}" type="text" disabled="disabled" class="input1"/></td>
                <td width="45%" class="td"> <span class="errorImg"></span><span class="errorMsg"></span></td>
              </tr>
              <tr>
                <th width="18%" align="left"><span>*</span>代码名称：</th>
                <td class="td1"><input name="detail" value="$!{feeCode.detail}" type="text" size="26" maxlength="13" class="input2"></td>
                    <td width="40%" class="td1"> <span class="errorImg"></span><span class="errorMsg" ></span></td>
              </tr>
             <tr>
                <th width="18%" align="left"><span>*</span>类型：</th>
                <td class="td"><input id="feeType" name="feeType" class="select1"/></td>
                <td class="td"><span class="errorImg"></span><span class="errorMsg"></span></td>
              </tr>
             <tr>
                <th width="18%" align="left"><span>*</span>分类：</th>
                <td class="td1"> <input id="category" name="category" class="select1"/></td>
                <td class="td1"><span class="errorImg"></span><span class="errorMsg"></span></td>
              </tr>
              <tr>
                <th width="30%" align="left"><span>*</span>金额：</th>
                <td class="td"><input type='text' name='amount' value="$!{feeCode.amount}" maxlength="13" class="input1"/>分</td>
                <td class="td"><span class="errorImg"></span><span class="errorMsg"></span></td>
              </tr>
              </table>
              </td></tr><tr><td>
            <table width="100%" cellpadding="0" cellspacing="0">
              <tr>
                <td height="15"></td>
              </tr>
              <tr>
                <td align="center"><input name="submit" type="submit" value="提交修改" class="popbtn" onmouseover="this.className='popbtnhover'" onmouseout="this.className='popbtn'"/>
                <input type="button"  value="取消" class="popbtn" onmouseover="this.className='popbtnhover'" onmouseout="this.className='popbtn'" onclick="closeDialog();"/>
              </tr>
             </table>
             </td></tr>
             <table>
          </form>
</div>
</body>
</html>