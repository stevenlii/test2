<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head> 
<link rel="stylesheet" type="text/css" href="${request.contextPath}/profile/default/css/common.css">
<link rel="stylesheet" href="$request.contextPath/js/ui/themes/default/om-all.css" type="text/css">
<link rel="stylesheet" type="text/css" href="${request.contextPath}/profile/validate/css/v1.css">
<script src="$request.contextPath/js/ui/jquery.min.js"></script>
<script src="$request.contextPath/js/ui/js/om-core.js"></script>
<script src="$request.contextPath/js/ui/js/om-validate.js"></script>
<script src="$request.contextPath/js/ui/js/om-combo.js"></script>
<script src="$request.contextPath/js/ui/js/om-ajaxsubmit.js"></script>
<script src="$request.contextPath/js/ui/js/om-messagebox.js"></script>
<script src="$request.contextPath/js/ui/js/om-button.js"></script>
<script src="$request.contextPath/js/busi/mercnf.js"></script>
<script>
  $(document).ready(function() {
    $("#container").width($(window).width());
      $("#dataform").validate({
        onkeyup: false,
        rules : {
          "file": {required : true}
        },
        messages : {
            "file": {required : "请上传证书"}
        },
        errorPlacement : function(error, element) { 
          if(error.html()){
            $(element).parents().map(function(){
              if(this.tagName.toLowerCase()=='td'){
                var attentionElement = $(this).next().children().eq(0);
                attentionElement.css('display','block');
                attentionElement.next().html(error);
                attentionElement.next().css('display','block');
              }
            });
          }
        },
        showErrors: function(errorMap, errorList) {
          if(errorList && errorList.length > 0){
            $.each(errorList,function(index,obj){
              var msg = this.message;
              $(obj.element).parents().map(function(){
                if(this.tagName.toLowerCase()=='td'){
                  var attentionElement = $(this).next().children().eq(0);
                  attentionElement.show();
                  attentionElement.next().html(msg);
                }
              });
 	        });
          }else{
            $(this.currentElements).parents().map(function(){
	          if(this.tagName.toLowerCase()=='td'){
	            $(this).next().children().eq(0).hide();
	            $(this).next().children().eq(1).hide();
	          }
	        });
          }
          this.defaultShowErrors();
        }, 
        submitHandler : function(){
          jQuery(this).submit();
          return false;
        }
      });
      $('#dataform').submit(function() {
        if (!$("#dataform").valid()) 
          return false;
        var file=$("input[name='file']").val();
        if("" == file){
          window.parent.$.omMessageBox.alert({content:'没有修改，不需提交'});
          return false;
        }
        jQuery(this).omAjaxSubmit({success:function(res){
          if(res =='1') {
            window.parent.$.omMessageBox.alert({type : 'success',title : '操作提示',content : '操作成功'});
          }else if(res=='2'){
            window.parent.$.omMessageBox.alert({type : 'warning',title : '操作提示',content : '证书大小不能超过4000个字节'});
            return false;
          }else{
            window.parent.$.omMessageBox.alert({type : 'error',title : '操作提示',content : '操作失败'});
          }
          closeDialog();
          window.parent.shuaxin();
          window.parent.showSimpleTip(res);
        }
      });
      return false; 
    });
  });
        
  //关闭窗口方法
  function  closeDialog(){
    window.parent.fillBackAndCloseDialog("#dialog"); 
  }
</script>  
</head>
<body>
  <div id="container">
    <form id ="dataform" method="post" name="dataform" action="${request.contextPath}/mercnf/modCert.do" enctype="multipart/form-data">
      <input type="hidden" name="merId" value="$!{merCnf.merId}">
      <table width="100%" >
        <tr>
          <td>
            <table width="100%" cellpadding="0" cellspacing="0" class="infowrite">
              <tr>
                <th width="30%" align="left">商户：</th>
                <td class="td">$!{merCnf.merId}【$!{merCnf.merName}】</td>
                <td width="35%" class="td"></td>
              </tr>
              <tr>
                <th width="18%" align="left"><span>*</span>证书：</th>
                <td class="td"><input id="file" name="file" type="file" class="input2" /></td>
                <td class="td"><span class="errorImg"></span><span class="errorMsg"></span></td>
              </tr>
            </table>
          </td>
        </tr>
        <tr>
          <td>
            <table width="100%" cellpadding="0" cellspacing="0">
              <tr>
                <td height="15"></td>
              </tr>
              <tr>
                <td align="center">
                  <input name="conf" type="submit" value="上传" class="popbtn" onmouseover="this.className='popbtnhover'" onmouseout="this.className='popbtn'"/>
                  <input id="add_button2" name="add_button2" type="reset"  value="取消" class="popbtn" onmouseover="this.className='popbtnhover'" onmouseout="this.className='popbtn'" onclick="closeDialog();"/>
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
    </form>
  </div>
</body>
</html>