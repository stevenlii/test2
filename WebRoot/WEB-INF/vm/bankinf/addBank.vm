<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
<link rel="stylesheet" type="text/css" href="${request.contextPath}/profile/default/css/common.css">
<link rel="stylesheet" href="$request.contextPath/js/ui/themes/default/om-all.css" type="text/css">
<script src="$request.contextPath/js/ui/jquery.min.js"></script>
<script src="$request.contextPath/js/ui/js/om-core.js"></script>
<script src="$request.contextPath/js/ui/js/om-validate.js"></script>
<script type="text/javascript" src="$request.contextPath/js/ui/js/om-ajaxsubmit.js"></script>
<script src="$request.contextPath/js/ui/js/om-button.js"></script>
<script src="$request.contextPath/js/ui/js/om-dialog.js"></script>
<script src="$request.contextPath/js/ui/js/om-combo.js"></script>
<script src="$request.contextPath/js/ui/js/om-messagebox.js"></script>
<script src="$request.contextPath/js/busi/bankinf.js"></script>
<link rel="stylesheet" type="text/css" href="${request.contextPath}/profile/validate/css/v1.css">

  <script>
  	   jQuery(document).ready(function() {
  		 jQuery("#container").width(jQuery(window).width());
  	       //获取支付服务商类型列表
  	     $('#bankType').omCombo({
                dataSource : '$request.contextPath/option/banktype.do',
                width:'152px',
                listMaxHeight:80,
                emptyText:'请选择..' ,
                forceSelection : true
            });
  	    $.validator.addMethod("check", function(value) {
  	        return checkBankId(value);
  	    }, "支付服务商编号已经存在！");
  	 	 jQuery("#dataform").validate({
  	 		 	onkeyup: false,
                rules : {
                    "bankId" : {
                    	required : true ,
                    	check : true ,
                        maxlength : 8
                    },
                    "bankName": {
                        required : true,
                        maxlength : 16
                    },
                    "bankType": {
                        required : true
                    }
                },
                messages : {
                    "bankId"  : {
                        required : "请输入支付服务商编号",
                        maxlength : "支付服务商编号不能大于8位"
                    },
                    "bankName": {
                        required : "请输入支付服务商名称",
                        maxlength : "支付服务商名称最多16个字符"
                    },
                     "bankType"  : {
                        required : "请选择支付服务商类型"
                      }
                  },
                
                errorPlacement : function(error, element) { 
                    if(error.html()){
	                    $(element).parents().map(function(){
	                        if(this.tagName.toLowerCase()=='td'){
	                            var attentionElement = $(this).next().children().eq(0);
	                            attentionElement.css('display','block');
	    	                    attentionElement.next().html(error);
	    	                    attentionElement.next().css('display','block');
	                        }
	                    });
                    }
    	        },
    	        showErrors: function(errorMap, errorList) {
                    if(errorList && errorList.length > 0){
                        $.each(errorList,function(index,obj){
                            var msg = this.message;
                            $(obj.element).parents().map(function(){
    	                        if(this.tagName.toLowerCase()=='td'){
    	                            var attentionElement = $(this).next().children().eq(0);
    	                            attentionElement.show();
    	    	                    attentionElement.next().html(msg);
    	                        }
    	                    });
 	                   });
                    }else{
                        $(this.currentElements).parents().map(function(){
	                        if(this.tagName.toLowerCase()=='td'){
	                            $(this).next().children().eq(0).hide();
	                            $(this).next().children().eq(1).hide();
	                        }
	                    });
                    }
                    this.defaultShowErrors();
                },
                
                submitHandler : function(){
 					jQuery(this).submit();
                    return false;
                }
                });
            
  	 	 jQuery('#dataform').submit(function() {
  	 	 	 if (!jQuery("#dataform").valid()) 
                 return false;
              jQuery(this).omAjaxSubmit({async:  false, success:function(res){
            	  if(res = 1){
            		  closeDialog(); 
            		  window.parent.shuaxin();
            	  }else{
            		  window.parent.showSimpleTip(res);
            	  }
                 }
                });
                return false;  
            });
   	 
  	     });
  	 
   //操作结果提示
   function checkBankId(bankId){
	   var res;
	   $.ajax({
			url : '$request.contextPath/bankinf/checkBankId.do',
			type : 'POST',
			dataType: 'text',
			async:  false,
			data : {
					'bankId' : bankId
			},
			success : function(msg){	
				 res=msg;
			}
	   });
	   if(res == 1)
	   {
		   return true;
	   }
	   else {
		   return false;
	   }
	}
  </script>  
  </head>
  <body>
<div id="container">
          <form id ="dataform" method="post" name="dataform" action="${request.contextPath}/bankinf/save.do">
          <table width="100%" >
          <tr><td>
            <table width="100%" cellpadding="0" cellspacing="0" class="infowrite">
              <tr>
                <th width="35%"><span>*</span>支付服务商编号：</th>
                <td  class="td"><input id="bankId" name="bankId" type="text" size="10" maxlength="8" class="input2" ></td>
                <td width="42%" class="td"> <span class="errorImg"></span><span class="errorMsg"></span></td>
              </tr>
              <tr>
                <th><span>*</span>支付服务商名称：</th>
                <td class="td1"><input  name="bankName" type="text"  size="16" maxlength="16" class="input2" ></td>
                <td class="td1"><span class="errorImg"></span><span class="errorMsg"></span></td>
              </tr>
          
             <tr>
                <th><span>*</span>支付服务商类型：</th>
                <td class="td"><input id="bankType" name="bankType" class="select3"/></td>
                <td class="td"><span class="errorImg"></span><span class="errorMsg"></span></td>
            </tr>
            </table>
            </td></tr><tr><td>
             <table width="100%" cellpadding="0" cellspacing="0">
                 <tr>
                    <td height="15"></td></tr>
                 <tr>
                    <td align="center">
                    <input id="add_button1" name="submit" type="submit" value="添加" class="popbtn"onmouseover="this.className='popbtnhover'" onmouseout="this.className='popbtn'"/>
                    <input id="add_button2" name="add_button2" type="button"  value="取消" class="popbtn" onmouseover="this.className='popbtnhover'" onmouseout="this.className='popbtn'" onclick="closeDialog();"/>
                  </tr>
             </table>
         </td></tr>
         <table>
     </form>
                  
</div>
</body>
</html>