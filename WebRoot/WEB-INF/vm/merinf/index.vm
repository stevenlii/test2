<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="${request.contextPath}/js/ui/themes/default/om-all.css" type="text/css">
<link rel="stylesheet" type="text/css" href="${request.contextPath}/profile/default/css/common.css">
<script src="$request.contextPath/js/ui/jquery.min.js"></script>
<script src="$request.contextPath/js/ui/js/om-core.js"></script>
<script type="text/javascript" src="$request.contextPath/js/ui/js/om-grid.js"></script>
<script src="$request.contextPath/js/ui/js/om-mouse.js"></script>
<script src="$request.contextPath/js/ui/js/om-draggable.js"></script>
<script src="$request.contextPath/js/ui/js/om-position.js"></script>
<script src="$request.contextPath/js/ui/js/om-resizable.js"></script>
<script src="$request.contextPath/js/ui/js/om-dialog.js"></script>
<script src="$request.contextPath/js/ui/js/om-combo.js"></script>
<script src="$request.contextPath/js/ui/js/om-messagebox.js"></script>
<script src="$request.contextPath/js/ui/js/om-button.js"></script>
<script src="$request.contextPath/js/ui/js/om-validate.js"></script>
<script type="text/javascript" src="$request.contextPath/js/ui/js/om-ajaxsubmit.js"></script>
<link rel="stylesheet" type="text/css" href="${request.contextPath}/profile/default/css/zTreeStyle.css">
<script src="$request.contextPath/js/ui/jquery.ztree.all-3.4.js"></script>
<script src="$request.contextPath/js/busi/merInf.js"></script>
<script type="text/javascript">
var setting2 = {
	data: {simpleData: {enable: true}},
	callback: {onClick: onClick2}
};
 	  var url="$request.contextPath/merinf/query.do?queryKey=mers.allMers";
        jQuery(document).ready(function() {
        	jQuery("#search_div").width(jQuery(window).width()-20);

        	var busiType1="${busiType}";
    		var busiType=eval(busiType1);
    		$.fn.zTree.init($("#busiTypeTree"), setting2, busiType);
        	
			    var optStr="${opts}";
				var opts=optStr.split(',');
			    jQuery('[code]').each(function () {
			        var code=$(this).attr("code");
			        for(var i=0;i<opts.length;i++){
					   if(code==opts[i]){
						   $(this).css('display','inline');
							}
			    		};
					});
		
          jQuery('#grid').omGrid({
                dataSource : url,
                width:'100%',
                height : 455,
                limit : 15,
                singleSelect : false,
                rowClasses : function(rowIndex,rowData){
					if(rowData.MODLOCK==1){
						return "lock";
					}else{
						return "checkbox";
					}
				},
                colModel : [ {header : '更新时间', name : 'MODTIME',width : 100, align : 'left',renderer:function(value , rowData , rowIndex){
                				return "<a title='"+value+"'>"+value+"</a>";
                			}}, 
                             {header : '商户名称', name : 'MERNAME',width : 80, align : 'left',renderer:function(value , rowData , rowIndex){
                             	    return "<a title='"+value+"'>"+value+"</a>";
                              } },
                             {header : '商户号', name : 'MERID', width : 50, align : 'left',renderer:function(value , rowData , rowIndex){
                             	    return "<a title='"+value+"'>"+value+"</a>";
                              } },
                             {header : '业务属性', name : 'BUSITYPE',width : 85, align : 'left',renderer:function(value , rowData , rowIndex){
	                             	return "<a title='"+value+"'>"+value+"</a>";
                             }},  
                             {header : '商户分类', name : 'CATEGORY', width : 100, align : 'left',renderer:function(value , rowData , rowIndex){
                          	    return "<a title='"+value+"'>"+value+"</a>";
                             } },
                             {header : '接口类型', name : 'INTERTYPE ',width : 60, align : 'left',renderer:function(value , rowData , rowIndex){
                             	var interType = rowData.INTERTYPE;
                             	var name = "";
                             	if(interType==0){
                             		name = "标准";
                             	}else {
                             		name = "特殊";
                             	}
                             	return "<a title='"+name+"'>"+name+"</a>";
                             }},  
                             {header : '渠道报备', name : 'CHNLCHECK',width : 50,align : 'left',renderer:function(value , rowData , rowIndex){
                             	var chnlCheck = rowData.CHNLCHECK;
                             	var name = "";
                             	if(chnlCheck==0){
                             		name = "否";
                             	}else{
                             		name = "是";
                             	}
                             	return "<a title='"+name+"'>"+name+"</a>";
                             }},  
                             {header : '运营负责人', name : 'OPERATOR',width : 60,align : 'left',renderer:function(value , rowData , rowIndex){
                          	    return "<a title='"+value+"'>"+value+"</a>";
                             } },
                             
                             {header : '添加方式', name : 'ADDWAY',width : 50,align : 'left',renderer:function(value , rowData , rowIndex){
                             	var addWay = rowData.ADDWAY;
                             	var name = "";
                             	if(addWay==0){
                             		name = "本地";
	                            }else{ 
	                            	name = "基地";
	                            }
                             	return "<a title='"+name+"'>"+name+"</a>";	
                             }},
                             {header : '状态', name : 'state',width : 50,align : 'left',renderer:function(value , rowData , rowIndex){
                             	var state = rowData.STATE;
                             	var name = "";
                             	if(state==2){
                             		name = "启用";
                             	}else{ 
                             		name = "禁用";
	                            }
	                          	return "<a title='"+name+"'>"+name+"</a>";
                             }
                             },
                             {header : '操作', name:'oper',width : 80, align : 'left',renderer:function(value , rowData , rowIndex){
	                             	var state = rowData.STATE;
	                             	var modLock=rowData.MODLOCK;
	                             	var result="";
	                             	if(optStr.indexOf("007")!=-1){//有修改权限
	                             		if(modLock==0)
	                             			result+=" <input  name='修改' title='修改' type='image' src='${request.contextPath}/profile/default/images/tool_modify.png' onclick='modify(&quot;"+rowData.MERID+"&quot;)'/> ";
	                             		else
	                             			result+=" <input  name='修改' title='修改' type='image' disabled='disabled' src='${request.contextPath}/profile/default/images/tool_modify1.png' /> ";
	                             	}
	                             	
	                             	if(modLock==0){// 正常
	                             		if(state==2){//启用状态
	                             			if(optStr.indexOf("003")!=-1){//有禁用权限，返回修改、禁用、详情按钮
	                             				result+="<input  name='禁用' title='禁用' type='image'  src='${request.contextPath}/profile/default/images/tool_Disable.png' onclick='singleDisable(&quot;"+rowData.MERID +"&quot;, "+ rowData.MODLOCK +" )'  /> ";  			                             				
	                             			}
	                             		}else{//禁用状态，不能修改
	                             			if(optStr.indexOf("004")!=-1){//有启用权限，返回修改、启用、详情按钮
	                             				result+="<input  name='启用' title='启用' type='image'  src='${request.contextPath}/profile/default/images/tool_Enable.png' onclick='singleEnable(&quot;"+rowData.MERID +"&quot;, "+ rowData.MODLOCK +" )'  /> ";
	                             			}
	                             		}
	                             	}else{//锁定，无法启用或禁用
	                             		if(state==2){//启用状态
	                             			if(optStr.indexOf("003")!=-1){//有禁用权限，返回修改（不可用变灰）、禁用（不可用变灰）、详情按钮
	                             				result+="<input  name='禁用' title='禁用' type='image' disabled='disabled' src='${request.contextPath}/profile/default/images/tool_Disable1.png' onclick='singleDisable(&quot;"+rowData.MERID +"&quot;, "+ rowData.MODLOCK +" )'  /> ";
	                             			}
	                             		}else{//禁用状态
	                             			if(optStr.indexOf("004")!=-1){//有启用权限，返回修改（不可用变灰）、启用（不可用变灰）、详情按钮
	                             				result+="<input  name='启用' title='启用' type='image' disabled='disabled' src='${request.contextPath}/profile/default/images/tool_Enable1.png' onclick='singleEnable(&quot;"+rowData.MERID +"&quot;, "+ rowData.MODLOCK +" )'  /> ";
	                             			}
	                             		}
	                             	}
                             		result+=" <input name='详情' title='详情' type='image' src='${request.contextPath}/profile/default/images/tool_details.png' onclick='shows(&quot;"+rowData.MERID+"&quot;)' />";
	                             	return result;	
                             }}
                            ],
                            autoFit:true
            });
            
            jQuery( "#dialog").omDialog({
                autoOpen: false
             });
             
          //初始化商户分类列表 
          $('#category').omCombo({
                dataSource : '$request.contextPath/option/mercategory.do',
                width:'75px',
                listMaxHeight:150,
                emptyText:'全部 ' ,
                onSuccess:function(data, textStatus, event){
       	  			var tmp = $.parseJSON('{"value":"","text":"全部"}');
       	  			data.unshift(tmp);
          		},
          		forceSelection : true
           });
           //初始化运营负责人列表
          jQuery('#operator').omCombo({
              dataSource : '$request.contextPath/option/operatorlist3.do',
              width:'75px',
              listMaxHeight:150,
              emptyText:'全部 ' ,
              valueField : 'id',
              inputField : 'name',
              optionField : function(data, index) {return data.name;},
              onSuccess:function(data, textStatus, event){
     	  			var tmp = $.parseJSON('{"id":"","name":"全部","initials":"qb"}');
     	  			data.unshift(tmp);
        		},
        	  filterStrategy : function(value, data) {
        			var initials=data.initials+"";
        			var list=initials.split(",");
        			for(var i=0;i<list.length;i++){
        				if(list[i].indexOf(value) == 0)
        					return true;
        			}
                    return false;
              },
              filterDelay : 100,
        	  forceSelection : true
          }); 
//          jQuery('#operator').omCombo({
//                dataSource : '$request.contextPath/option/operatorlist.do',
//                width:'75px',
//                listMaxHeight:150,
//                emptyText:'全部 ' ,
//                onSuccess:function(data, textStatus, event){
//       	  			var tmp = $.parseJSON('{"value":"","text":"全部"}');
//       	  			data.unshift(tmp);
//          		},
//          		forceSelection : true
//           }); 
    	//状态       
      	  $('#state').omCombo({
              dataSource : [{"value":"","text":"全部"},{"value":"2","text":"启用"},{"value":"4","text":"禁用"}],
              width:'75px',
              emptyText:'全部 ' ,
              forceSelection : true
          });
      	//添加方式 
      	  $('#addWay').omCombo({
              dataSource : [{"value":"","text":"全部"},{"value":"0","text":"本地"},{"value":"1","text":"基地"}],
              width:'90px',
              emptyText:'全部 ' ,
              forceSelection : true
          });
      	//渠道报备
      	  $('#chnlCheck').omCombo({
              dataSource : [{"value":"","text":"全部"},{"value":"1","text":"是"},{"value":"0","text":"否"}],
              width:'60px',
              emptyText:'全部 ' ,
              forceSelection : true
          });
      	//接口类型 
      	  $('#interType').omCombo({
              dataSource : [{"value":"","text":"全部"},{"value":"0","text":"标准"},{"value":"1","text":"特殊"}],
              width:'60px',
              emptyText:'全部 ' ,
              forceSelection : true
          });
      	  
      	var dialog = $("#dialog-import").omDialog({
  			title:'导入老商户',
            width: 370,
            autoOpen : false,
            modal : true,
            resizable : false
      });
      	jQuery('#ipForm').submit(function() {
            var merId = document.getElementById("oldMerId").value;
            if(merId == ""){
            	alert("请输入商户号！");
            	return false;
            }
            jQuery(this).omAjaxSubmit({
            		dataType : 'json',
            		success:function(res){
            			if(res.flag=='yes'){
            				$.omMessageBox.alert({
			    	        	type:'success',
			    	            title : '操作提示',
			    	            content : res.result
			    	        });
            				closeDialog("dialog-import");
            				shuaxin();
            			}else if(res.flag=='no'){
            				$.omMessageBox.alert({
            					type:'error',
            					title : '操作提示',
            					content : res.result
            				});
            			}
                    }
             });
            
             return false; 
        });
        
       });
       
        function importMer(){
        	$("#dialog-import").omDialog("open");
        	$('#oldMerId').val('');
        }
        
</script>

</head>
<body>

    <!--增 删 改按钮区-->
    <div class="list_btntool">
     
      <table border="0" width="100%">
        <tr>
        <td align="left">
             <input name="禁用" type="image" title='禁用' style="display:none" code="003" src="${request.contextPath}/profile/default/images/btn_Disable.png" onclick="batchstop();"/>
             <input name="启用" type="image" title='启用' style="display:none" code="004" src="${request.contextPath}/profile/default/images/btn_Enable.png" onclick="batchstart();"/></td>
		<td align="right">
			 <input name="导入老商户" type="image" title='导入老商户' style="display:none" code="008" src="${request.contextPath}/profile/default/images/btn_lsh.png" onclick="importMer();"/>
		     <input name="添加商户" type="image" title='添加商户' style="display:none" code="005" src="${request.contextPath}/profile/default/images/btn_Add1.png" onclick="show();"/>
      	     <input name="导出" type="image" title='导出' style="display:none" code="002" src="${request.contextPath}/profile/default/images/btn_Export.png" onclick="expMer();"/></td>
         </tr>
        </table>
     </div>
  
 <!--列表查询区-->
 <div  id="search_div">
   <div class="list_search">
   <table width="90%" border="0">
       <tr>
        <td  align="left" >
          <!--查询块区 start--> 
           <form id="form" method="post"> 
            <table width="100%" border="0">
              <tr>
	              <th width="8%">商户号：</th>
	              <td width="8%"><input id="merId" name="merId" type="text" class="input1" style="width:60px"/></td>
		         <th width="10%">商户名：</th>
		         <td width="10%"><input id="merName" name="merName" type="text" class="input1" style="width:75px"/></td>
		         <th width="10%">业务属性：</th>
		         <td width="8%">
		         	<span class="om-combo om-widget om-state-default" style="width: 90px;">
		         		<input type="text" id="merBusiType" readonly value="全部" onclick="showMenu2(); return false;" onkeydown="refuseBackspace()" class="select1" style="width: 69px;"><span onclick="showMenu2(); return false;" class="om-combo-trigger ioi_trigger"></span>
		         	</span>
		         	<input type="hidden" id="busiType" name="busiType" value="" type="text" />
		         </td>
		         <th width="10%">商户分类：</th>
		         <td width="10%"><input  id="category" name="category" class="input1"/></td>
		         <th width="10%">接口类型：</th>
		         <td width="8%"><input id="interType" name="interType" class="select1"></td>
		       </tr>
		       <tr>
           		 <th>是否报备：</th>
		         <td><input id="chnlCheck" name="chnlCheck" class="select1"></td>
		         <th>运营负责人：</th>
		         <td><input id="operator" name="operator" class="select1"/></td>
		         <th>添加方式：</th>
		         <td><input id="addWay" name="addWay" class="select1"/></td>
		         <th>状态：</th>
		         <td><input id="state" name="state" class="select1"/></td>
          </tr>
        </table>
        </form> 
       </td>
         <td align="left"><input id="query" title="查询" name="submit" type="image" style="display:none" code="001" value="ee" src="${request.contextPath}/profile/default/images/Search_bnt.png" onclick="query();"/>
         </td>
       </tr>
     </table>
     </div>
   </div>  
   
   <!--列表区-->
    <table id="grid" align="left"></table>
    
 <div id="dialog">
    <iframe frameborder="0" style="width:100%;height:99%" src="about:blank"></iframe>
 </div>
	<div id="dialog-import" style="display:none;">
    <form id="ipForm" method="post" action="$request.contextPath/merinf/importMer.do" >
        <table style="width:100%;">
            <tr>
                <th width="78px"><span style="color:red;">*</span>老商户号：</th>
                <td><input id="oldMerId" name="oldMerId" type="text" maxlength="4" class="input2" /></td>
            </tr>
            <tr>
            	<td colspan="2">注：<br>&nbsp;&nbsp;1、导出的数据会显示在列表页的首行。
            	<br>&nbsp;&nbsp;2、因导入的部分数据值为空。请尽快修改商户、商品信息并提交审核。<td>
            </tr>
        </table>
        <div align='center'>
            	<input name="Submit" type="submit" class="popbtn" value="提交" onmouseover="this.className='popbtnhover'" onmouseout="this.className='popbtn'"/>
     			<input name="close" type="button" class="popbtn"  value="取消" onclick="closeDialog('dialog-import');" onmouseover="this.className='popbtnhover'" onmouseout="this.className='popbtn'"/>
     	</div>
    </form>
 </div>
<div id="menuContent2" class="list_zTree">
	<ul id="busiTypeTree" class="ztree" style="margin-top:0; width:160px; height:150px;overflow:auto;"></ul>
</div>
</body>
</html>
